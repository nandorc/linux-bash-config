#!/bin/bash

# Load dependencies
source ~/.bash_utilities/lib/ext/dsoft/messages.sh
source ~/.bash_utilities/src/setpermissions/data/inputs.sh

if [ $showhelp -eq 1 ]; then
    mdv ~/.bash_utilities/src/setpermissions/README.md
elif [ -z "$path" ]; then
    printErrorMessage "A path to a file/folder must be specified to apply permissions" both
elif [ ! -d "$path" ] && [ ! -f "$path" ]; then
    printErrorMessage "Not an existing file or folder at $path" both
fi

# # >>> OWNERSHIP <<<
# if [ ! -z "$ownername" ]; then
#     if [ ! -z "$groupname" ]; then
#         printInfoMessage "SETTING $ownername as OWNER AND $groupname AS GROUP FOR $path" 1
#     else
#         printInfoMessage "SETTING OWNERSHIP TO $ownername FOR $path" 1
#         groupname="$ownername"
#     fi
#     sleep 1
#     sudo chown -R -c "$ownername":"$groupname" "$path"
# elif [ ! -z $groupname ]; then
#     printInfoMessage "SETTING $groupname AS GROUP FOR $path" 1
#     sleep 1
#     sudo chown -R -c :"$groupname" "$path"
# fi

# # >>> EXECUTABLE FILES (0774 by default) <<<
# if [ -z "$exeperm" ]; then
#     exeperm=0774
# fi
# printInfoMessage "SETTING $exeperm PERMISSION TO EXECUTABLE FILES AT $path" 1
# sleep 1
# # Files without extension
# sudo find "$path" -type f ! -name "*.*" ! -perm "$exeperm" -exec chmod -c "$exeperm" {} +
# # .sh files
# sudo find "$path" -type f -name "*.sh" ! -perm "$exeperm" -exec chmod -c "$exeperm" {} +

# # >>> REGULAR FILES (0664 by default) <<<
# if [ -z "$filperm" ]; then
#     filperm=0664
# fi
# printInfoMessage "SETTING $filperm PERMISSION TO FILES AT $path" 1
# sleep 1
# sudo find "$path" -type f ! -perm "$exeperm" ! -perm "$filperm" -exec chmod -c "$filperm" {} +

# # >>> FOLDERS (2775 by default) <<<
# if [ -z "$dirperm" ]; then
#     dirperm=2775
# fi
# printInfoMessage "SETTING $dirperm PERMISSION TO FOLDERS AT $path" 1
# sleep 1
# sudo find "$path" -type d ! -perm "$dirperm" -exec chmod -c "$dirperm" {} +

# # >>> SCRIPT END MESSAGE <<<
# printInfoMessage "DONE" 1

# Clean inputs
unset ownername groupname filperm dirperm exeperm path
